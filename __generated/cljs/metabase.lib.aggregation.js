var window=global;var $CLJS=require("./cljs_env.js");require("./cljs.core.js");require("./medley.core.js");require("./metabase.lib.common.js");require("./metabase.lib.dispatch.js");require("./metabase.lib.equality.js");require("./metabase.lib.hierarchy.js");require("./metabase.lib.metadata.js");require("./metabase.lib.metadata.calculation.js");require("./metabase.lib.options.js");require("./metabase.lib.ref.js");require("./metabase.lib.schema.js");require("./metabase.lib.schema.aggregation.js");require("./metabase.lib.schema.common.js");require("./metabase.lib.temporal_bucket.js");require("./metabase.lib.types.isa.js");require("./metabase.lib.util.js");require("./metabase.shared.util.i18n.js");require("./metabase.util.js");require("./metabase.util.malli.js");
'use strict';var B3,D3,E3,F3,kra;B3=function(a,b,c){var d=$CLJS.DV(a,b);d=$CLJS.O(d);d=$CLJS.J.g(d,$CLJS.aF);d=$CLJS.rG($CLJS.hk.j($CLJS.eh([c]),$CLJS.AD,$CLJS.id),d);if(!$CLJS.n(d))throw $CLJS.ji($CLJS.iD("No aggregation with uuid {0}",$CLJS.H([c])),new $CLJS.h(null,3,[$CLJS.ur,c,$CLJS.HE,a,$CLJS.CK,b],null));return d};$CLJS.C3=function(a){return $CLJS.k1($CLJS.xF,new $CLJS.Q(null,1,5,$CLJS.R,[a],null))};
D3=new $CLJS.M("metabase.lib.aggregation","unary-aggregation","metabase.lib.aggregation/unary-aggregation",1064133592);E3=new $CLJS.M("metabase.lib.aggregation","count-aggregation","metabase.lib.aggregation/count-aggregation",-21314018);F3=new $CLJS.M("metabase.lib.aggregation","aggregation","metabase.lib.aggregation/aggregation",1701573815);kra=new $CLJS.M(null,"aggregation-operator","aggregation-operator",-1978700834);$CLJS.H_.m(null,$CLJS.aF,function(a,b){var c=$CLJS.Ie($CLJS.aF.h($CLJS.DV(a,b)));return $CLJS.n(c)?$CLJS.m1($CLJS.LD("and"),function(){return function f(e){return new $CLJS.pe(null,function(){for(;;){var k=$CLJS.y(e);if(k){if($CLJS.Bd(k)){var l=$CLJS.mc(k),m=$CLJS.D(l),t=$CLJS.se(m);a:for(var u=0;;)if(u<m){var v=$CLJS.ld(l,u);v=$CLJS.e_.v(a,b,v,$CLJS.f_);t.add(v);u+=1}else{l=!0;break a}return l?$CLJS.ve($CLJS.xe(t),f($CLJS.nc(k))):$CLJS.ve($CLJS.xe(t),null)}t=$CLJS.z(k);return $CLJS.ge($CLJS.e_.v(a,
b,t,$CLJS.f_),f($CLJS.Mc(k)))}return null}},null,null)}(c)}()):null});$CLJS.K_.m(null,$CLJS.aF,function(a,b,c){$CLJS.I(c,0,null);var d=$CLJS.I(c,1,null),e=$CLJS.O(d);d=$CLJS.J.g(e,$CLJS.nA);e=$CLJS.J.g(e,$CLJS.Ci);c=$CLJS.I(c,2,null);c=B3(a,b,c);return $CLJS.zk.l($CLJS.H([$CLJS.c_.j(a,b,c),new $CLJS.h(null,2,[$CLJS.IJ,$CLJS.hK,$CLJS.t0,$CLJS.AD.h($CLJS.id(c))],null),$CLJS.n(d)?new $CLJS.h(null,1,[$CLJS.nA,d],null):null,$CLJS.n(e)?new $CLJS.h(null,1,[$CLJS.Ci,e],null):null]))});
$CLJS.E_.m(null,$CLJS.aF,function(a,b,c,d){$CLJS.I(c,0,null);$CLJS.I(c,1,null);c=$CLJS.I(c,2,null);return $CLJS.e_.v(a,b,B3(a,b,c),d)});$CLJS.rE(E3,F3);
for(var G3=$CLJS.y(new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Mw,$CLJS.mF],null)),H3=null,I3=0,J3=0;;)if(J3<I3){var lra=H3.X(null,J3);$CLJS.rE(lra,E3);J3+=1}else{var K3=$CLJS.y(G3);if(K3){var L3=K3;if($CLJS.Bd(L3)){var M3=$CLJS.mc(L3),mra=$CLJS.nc(L3),nra=M3,ora=$CLJS.D(M3);G3=mra;H3=nra;I3=ora}else{var pra=$CLJS.z(L3);$CLJS.rE(pra,E3);G3=$CLJS.B(L3);H3=null;I3=0}J3=0}else break}
$CLJS.E_.m(null,E3,function(a,b,c,d){var e=$CLJS.I(c,0,null);$CLJS.I(c,1,null);c=$CLJS.I(c,2,null);if($CLJS.n(c))switch(a=$CLJS.e_.v(a,b,c,d),e=e instanceof $CLJS.M?e.S:null,e){case "count":return $CLJS.iD("Count of {0}",$CLJS.H([a]));case "cum-count":return $CLJS.iD("Cumulative count of {0}",$CLJS.H([a]));default:throw Error(["No matching clause: ",$CLJS.p.h(e)].join(""));}else switch(e=e instanceof $CLJS.M?e.S:null,e){case "count":return $CLJS.LD("Count");case "cum-count":return $CLJS.LD("Cumulative count");
default:throw Error(["No matching clause: ",$CLJS.p.h(e)].join(""));}});$CLJS.F_.m(null,E3,function(a,b,c){a=$CLJS.I(c,0,null);a=a instanceof $CLJS.M?a.S:null;switch(a){case "count":return"count";case "cum-count":return"cum_count";default:throw Error(["No matching clause: ",$CLJS.p.h(a)].join(""));}});$CLJS.K_.m(null,E3,function(a,b,c){var d=$CLJS.T.j,e=$CLJS.kH($CLJS.K_,F3);a=e.j?e.j(a,b,c):e.call(null,a,b,c);return d.call($CLJS.T,a,$CLJS.yj,$CLJS.PB)});$CLJS.E_.m(null,$CLJS.UE,function(){return $CLJS.LD("Case")});
$CLJS.F_.m(null,$CLJS.UE,function(){return"case"});$CLJS.rE(D3,F3);for(var N3=$CLJS.y(new $CLJS.Q(null,9,5,$CLJS.R,[$CLJS.fF,$CLJS.GF,$CLJS.QE,$CLJS.Hj,$CLJS.yF,$CLJS.ln,$CLJS.zF,$CLJS.xF,$CLJS.RE],null)),O3=null,P3=0,Q3=0;;)if(Q3<P3){var qra=O3.X(null,Q3);$CLJS.rE(qra,D3);Q3+=1}else{var R3=$CLJS.y(N3);if(R3){var S3=R3;if($CLJS.Bd(S3)){var T3=$CLJS.mc(S3),rra=$CLJS.nc(S3),sra=T3,tra=$CLJS.D(T3);N3=rra;O3=sra;P3=tra}else{var ura=$CLJS.z(S3);$CLJS.rE(ura,D3);N3=$CLJS.B(S3);O3=null;P3=0}Q3=0}else break}
$CLJS.F_.m(null,D3,function(a,b,c){a=$CLJS.I(c,0,null);$CLJS.I(c,1,null);$CLJS.I(c,2,null);c=a instanceof $CLJS.M?a.S:null;switch(c){case "avg":return"avg";case "cum-sum":return"sum";case "distinct":return"count";case "max":return"max";case "median":return"median";case "min":return"min";case "stddev":return"stddev";case "sum":return"sum";case "var":return"var";default:throw Error(["No matching clause: ",$CLJS.p.h(c)].join(""));}});
$CLJS.E_.m(null,D3,function(a,b,c,d){var e=$CLJS.I(c,0,null);$CLJS.I(c,1,null);c=$CLJS.I(c,2,null);a=$CLJS.e_.v(a,b,c,d);e=e instanceof $CLJS.M?e.S:null;switch(e){case "avg":return $CLJS.iD("Average of {0}",$CLJS.H([a]));case "cum-sum":return $CLJS.iD("Cumulative sum of {0}",$CLJS.H([a]));case "distinct":return $CLJS.iD("Distinct values of {0}",$CLJS.H([a]));case "max":return $CLJS.iD("Max of {0}",$CLJS.H([a]));case "median":return $CLJS.iD("Median of {0}",$CLJS.H([a]));case "min":return $CLJS.iD("Min of {0}",
$CLJS.H([a]));case "stddev":return $CLJS.iD("Standard deviation of {0}",$CLJS.H([a]));case "sum":return $CLJS.iD("Sum of {0}",$CLJS.H([a]));case "var":return $CLJS.iD("Variance of {0}",$CLJS.H([a]));default:throw Error(["No matching clause: ",$CLJS.p.h(e)].join(""));}});$CLJS.E_.m(null,$CLJS.XE,function(a,b,c,d){$CLJS.I(c,0,null);$CLJS.I(c,1,null);var e=$CLJS.I(c,2,null);c=$CLJS.I(c,3,null);return $CLJS.iD("{0}th percentile of {1}",$CLJS.H([c,$CLJS.e_.v(a,b,e,d)]))});$CLJS.F_.m(null,$CLJS.XE,function(){return"percentile"});
$CLJS.rE($CLJS.XE,F3);$CLJS.E_.m(null,$CLJS.EF,function(a,b,c,d){$CLJS.I(c,0,null);$CLJS.I(c,1,null);var e=$CLJS.I(c,2,null);$CLJS.I(c,3,null);return $CLJS.iD("Sum of {0} matching condition",$CLJS.H([$CLJS.e_.v(a,b,e,d)]))});$CLJS.F_.m(null,$CLJS.EF,function(a,b,c){$CLJS.I(c,0,null);$CLJS.I(c,1,null);var d=$CLJS.I(c,2,null);$CLJS.I(c,3,null);return["sum_where_",$CLJS.p.h($CLJS.G_.j(a,b,d))].join("")});$CLJS.rE($CLJS.EF,F3);$CLJS.E_.m(null,$CLJS.sF,function(){return $CLJS.LD("Share of rows matching condition")});
$CLJS.F_.m(null,$CLJS.sF,function(){return"share"});$CLJS.rE($CLJS.sF,F3);$CLJS.E_.m(null,$CLJS.uF,function(){return $CLJS.LD("Count of rows matching condition")});$CLJS.F_.m(null,$CLJS.uF,function(){return"count-where"});$CLJS.rE($CLJS.uF,F3);
$CLJS.K_.m(null,F3,function(a,b,c){$CLJS.I(c,0,null);$CLJS.I(c,1,null);var d=$CLJS.I(c,2,null),e=$CLJS.zk.l;d=$CLJS.n(d)?$CLJS.Hl($CLJS.c_.j(a,b,d),new $CLJS.Q(null,1,5,$CLJS.R,[$CLJS.YJ],null)):null;var f=$CLJS.kH($CLJS.K_,$CLJS.ei);a=f.j?f.j(a,b,c):f.call(null,a,b,c);return e.call($CLJS.zk,$CLJS.H([d,a]))});
$CLJS.vra=function(){function a(d){return $CLJS.k1($CLJS.Mw,new $CLJS.Q(null,1,5,$CLJS.R,[d],null))}function b(){return $CLJS.k1($CLJS.Mw,$CLJS.Ef)}var c=null;c=function(d){switch(arguments.length){case 0:return b.call(this);case 1:return a.call(this,d)}throw Error("Invalid arity: "+arguments.length);};c.o=b;c.h=a;return c}();$CLJS.mV.m(null,$CLJS.aF,function(a){return a});
$CLJS.U3=function(){function a(d,e,f){for(;;)if($CLJS.E.g($CLJS.SA(f),$CLJS.MJ))f=$CLJS.oV(f);else return $CLJS.o1(d,e,$CLJS.aF,f)}function b(d,e){return c.j?c.j(d,-1,e):c.call(null,d,-1,e)}var c=null;c=function(d,e,f){switch(arguments.length){case 2:return b.call(this,d,e);case 3:return a.call(this,d,e,f)}throw Error("Invalid arity: "+arguments.length);};c.g=b;c.j=a;return c}();
$CLJS.V3=function(){function a(d,e){return $CLJS.Ie($CLJS.aF.h($CLJS.DV(d,e)))}function b(d){return c.g?c.g(d,-1):c.call(null,d,-1)}var c=null;c=function(d,e){switch(arguments.length){case 1:return b.call(this,d);case 2:return a.call(this,d,e)}throw Error("Invalid arity: "+arguments.length);};c.h=b;c.g=a;return c}();
$CLJS.W3=function(){function a(d,e){var f=$CLJS.Ie($CLJS.aF.h($CLJS.DV(d,e)));return null==f?null:$CLJS.gg.j($CLJS.Ef,$CLJS.kf.h(function(k){var l=$CLJS.c_.j(d,e,k),m=$CLJS.T.l,t=$CLJS.nA.h(l);return m.call($CLJS.T,$CLJS.j1(l,$CLJS.Ci,$CLJS.n(t)?t:$CLJS.lj),$CLJS.IJ,$CLJS.hK,$CLJS.H([$CLJS.t0,$CLJS.AD.h($CLJS.id(k))]))}),f)}function b(d){return c.g?c.g(d,-1):c.call(null,d,-1)}var c=null;c=function(d,e){switch(arguments.length){case 1:return b.call(this,d);case 2:return a.call(this,d,e)}throw Error("Invalid arity: "+
arguments.length);};c.h=b;c.g=a;return c}();$CLJS.E_.m(null,$CLJS.SF,function(a,b,c){a=$CLJS.O(c);a=$CLJS.J.g(a,$CLJS.OF);return $CLJS.nD.h(a.o?a.o():a.call(null))});$CLJS.L_.m(null,$CLJS.SF,function(a,b,c){var d=$CLJS.O(c);a=$CLJS.J.g(d,$CLJS.eF);b=$CLJS.J.g(d,$CLJS.OF);c=$CLJS.J.g(d,$CLJS.NF);d=$CLJS.J.g(d,$CLJS.LY);a=$CLJS.T.l(b.o?b.o():b.call(null),$CLJS.C_,$CLJS.Uz(a),$CLJS.H([$CLJS.A_,c]));return null!=d?$CLJS.T.j(a,$CLJS.m_,d):a});
$CLJS.wra=function(){function a(d,e){var f=function(){var m=$CLJS.az.h($CLJS.P0(d));return $CLJS.n(m)?m:$CLJS.dh}(),k=$CLJS.DV(d,e),l=$CLJS.P_.j(d,e,k);return $CLJS.Ie($CLJS.gg.j($CLJS.Ef,$CLJS.hk.j($CLJS.mf(function(m){m=$CLJS.QF.h(m);var t=null==m;return t?t:f.h?f.h(m):f.call(null,m)}),$CLJS.zl(function(m){m=$CLJS.O(m);var t=$CLJS.J.g(m,$CLJS.NF),u=$CLJS.J.g(m,$CLJS.LF);if($CLJS.Wa(t))return m;if($CLJS.E.g(u,$CLJS.wr))return $CLJS.T.j(m,$CLJS.AV,l);t=$CLJS.Ie($CLJS.o0(function(v){return $CLJS.xZ(u,
v)},l));return $CLJS.n(t)?$CLJS.T.j(m,$CLJS.AV,t):null}),$CLJS.kf.h(function(m){return $CLJS.T.j(m,$CLJS.Us,$CLJS.SF)})),$CLJS.TF))}function b(d){return c.g?c.g(d,-1):c.call(null,d,-1)}var c=null;c=function(d,e){switch(arguments.length){case 1:return b.call(this,d);case 2:return a.call(this,d,e)}throw Error("Invalid arity: "+arguments.length);};c.h=b;c.g=a;return c}();
$CLJS.xra=function(){function a(d,e){return $CLJS.nV(new $CLJS.Q(null,3,5,$CLJS.R,[$CLJS.eF.h(d),$CLJS.N,$CLJS.pV.h(e)],null))}function b(d){if($CLJS.Wa($CLJS.NF.h(d)))return $CLJS.nV(new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.eF.h(d),$CLJS.N],null));var e=$CLJS.eF.h(d);e=$CLJS.ia.g?$CLJS.ia.g("aggregation operator %s requires an argument",e):$CLJS.ia.call(null,"aggregation operator %s requires an argument",e);throw $CLJS.ji(e,new $CLJS.h(null,1,[kra,d],null));}var c=null;c=function(d,e){switch(arguments.length){case 1:return b.call(this,
d);case 2:return a.call(this,d,e)}throw Error("Invalid arity: "+arguments.length);};c.h=b;c.g=a;return c}();