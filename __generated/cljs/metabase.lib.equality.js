var window=global;var $CLJS=require("./cljs_env.js");require("./cljs.core.js");require("./medley.core.js");require("./metabase.lib.card.js");require("./metabase.lib.convert.js");require("./metabase.lib.dispatch.js");require("./metabase.lib.hierarchy.js");require("./metabase.lib.metadata.js");require("./metabase.lib.options.js");require("./metabase.lib.ref.js");require("./metabase.lib.schema.js");require("./metabase.lib.schema.id.js");require("./metabase.lib.schema.metadata.js");require("./metabase.lib.schema.ref.js");require("./metabase.lib.util.js");require("./metabase.util.malli.js");
'use strict';var i1,ypa,p1,q1,s1,zpa,Apa,Bpa,Cpa,Dpa,Fpa,Gpa,Hpa,Epa,v1,w1;i1=function(a,b){var c=$CLJS.Hd,d=h1;for(a=$CLJS.y(a);;)if(null!=a){d=$CLJS.J.j(d,$CLJS.z(a),c);if(c===d)return b;a=$CLJS.B(a)}else return d};$CLJS.j1=function(a,b,c){return null==c||$CLJS.Jd(a,b)?a:$CLJS.T.j(a,b,c)};$CLJS.k1=function(a,b){return $CLJS.gg.j(new $CLJS.Q(null,2,5,$CLJS.R,[a,new $CLJS.h(null,1,[$CLJS.AD,$CLJS.p.h($CLJS.KD())],null)],null),$CLJS.kf.h($CLJS.pV),b)};
$CLJS.l1=function(a,b){a=$CLJS.CV(a,b);return 0<a?a-1:null};$CLJS.m1=function(a,b){if($CLJS.y(b)){if($CLJS.E.g($CLJS.D(b),1))return $CLJS.z(b);a=[" ",(0,$CLJS.na)(a)," "].join("");return $CLJS.E.g($CLJS.D(b),2)?[$CLJS.p.h($CLJS.z(b)),a,$CLJS.p.h($CLJS.id(b))].join(""):[$CLJS.gs(", ",$CLJS.ds(b)),",",a,$CLJS.p.h($CLJS.jd(b))].join("")}return null};$CLJS.n1=function(a){return $CLJS.MU.h($CLJS.z($CLJS.oK.h(a)))};
$CLJS.o1=function(a,b,c,d){a=$CLJS.BV(a);b=$CLJS.n(b)?b:-1;var e=$CLJS.DV(a,b);e=!($CLJS.y($CLJS.aF.h(e))||$CLJS.y($CLJS.$E.h(e)));c=$CLJS.PV.l(a,b,$CLJS.kk,$CLJS.H([c,function(f){return $CLJS.de.g($CLJS.Ff(f),$CLJS.pV.h(d))}]));return e?$CLJS.kk.M((0,$CLJS.PV)(c,b,function(f){return $CLJS.TV($CLJS.ak.l(f,$CLJS.LQ,$CLJS.H([$CLJS.TD])),$CLJS.BM,function(k){return $CLJS.jk.g(function(l){return $CLJS.ak.g(l,$CLJS.TD)},k)})}),$CLJS.oK,$CLJS.hk.g(function(f){return $CLJS.gg.g($CLJS.Ef,f)},$CLJS.ok),0,
$CLJS.CV(a,b)+1):c};ypa=function(a,b){b=$CLJS.$Z(a,b);return $CLJS.n(b)?$CLJS.e1(a,b):null};p1=function(a){return $CLJS.gg.j($CLJS.dh,$CLJS.ik.h(function(b){return $CLJS.oe(b)&&$CLJS.gk.g(b,$CLJS.Us)}),$CLJS.Zg(a))};q1=function(a){return $CLJS.gg.j($CLJS.N,$CLJS.Kl(function(b,c){$CLJS.I(c,0,null);c=$CLJS.I(c,1,null);c=$CLJS.O(c);c=$CLJS.J.g(c,$CLJS.AD);return new $CLJS.Q(null,2,5,$CLJS.R,[c,b],null)}),$CLJS.aF.h(a))};
$CLJS.r1=function(a,b,c){var d=$CLJS.zk.l;b=$CLJS.Wa($CLJS.l1(a,b))?function(){var f=$CLJS.n1(a);return $CLJS.n(f)?(f=ypa(a,f),$CLJS.n(f)?$CLJS.rG(function(k){return $CLJS.E.g($CLJS.Si.h(k),c)},f):null):null}():null;try{var e=$CLJS.Q0(a,c)}catch(f){e=null}return d.call($CLJS.zk,$CLJS.H([b,e]))};
s1=function(a,b){$CLJS.I(a,0,null);var c=$CLJS.I(a,1,null),d=$CLJS.O(c);c=$CLJS.J.g(d,$CLJS.rO);d=$CLJS.J.g(d,$CLJS.CM);$CLJS.I(a,2,null);a=$CLJS.n(d)?$CLJS.E.g(d,$CLJS.WJ.h(b)):d;return $CLJS.n(a)?a:$CLJS.E.g($CLJS.uz($CLJS.$Y,$CLJS.YY)(b),c)};
zpa=function(a,b){$CLJS.I(a,0,null);$CLJS.I(a,1,null);var c=$CLJS.I(a,2,null),d=$CLJS.Ie($CLJS.nf(function(e){var f=$CLJS.E.g($CLJS.KY.h(e),c);return f?s1(a,e):f},b));return $CLJS.n(d)?d:$CLJS.nf(function(e){var f=$CLJS.E.g($CLJS.U.h(e),c);return f?s1(a,e):f},b)};
Apa=function(a,b,c){$CLJS.I(a,0,null);var d=$CLJS.I(a,1,null),e=$CLJS.I(a,2,null),f=$CLJS.Ie($CLJS.nf(function(k){var l=$CLJS.E.g($CLJS.Si.h(k),e);if(l){if(l=$CLJS.Wa($CLJS.rO.h(d))){l=$CLJS.IJ.h(k);var m=new $CLJS.ch(null,new $CLJS.h(null,2,[$CLJS.NY,null,$CLJS.SY,null],null),null);l=m.h?m.h(l):m.call(null,l)}return $CLJS.n(l)?l:s1(a,k)}return l},b));if($CLJS.n(f))return f;b=$CLJS.n(c)?$CLJS.Ie($CLJS.nf(function(k){return $CLJS.E.g($CLJS.Si.h(k),e)},b)):null;return $CLJS.n(b)?b:$CLJS.Ef};
Bpa=function(a){var b=$CLJS.t1.g($CLJS.IJ.h(a),$CLJS.EY);return $CLJS.n(b)?b:$CLJS.rD.h(a)};
Cpa=function(a,b){b=$CLJS.Ie($CLJS.ik.g($CLJS.WJ,b));if($CLJS.n(b))if($CLJS.Wa($CLJS.B(b)))a=$CLJS.z(b);else{if($CLJS.n($CLJS.t1.g($CLJS.z(a),$CLJS.lF))){var c=$CLJS.Ie($CLJS.ik.g(Bpa,b));c=$CLJS.n(c)?$CLJS.B(c)?null:$CLJS.z(c):null}else c=null;a=$CLJS.n(c)?c:console.warn($CLJS.ji("Ambiguous match! Implement more logic in disambiguate-matches.",new $CLJS.h(null,2,[$CLJS.W,a,$CLJS.AV,b],null)))}else a=null;return a};
Dpa=function(a,b){b=$CLJS.Ie($CLJS.ik.g(function(c){var d=$CLJS.uz($CLJS.$Y,$CLJS.YY)(c);$CLJS.n(d)?(c=$CLJS.IJ.h(c),d=new $CLJS.ch(null,new $CLJS.h(null,1,[$CLJS.NY,null],null),null),c=d.h?d.h(c):d.call(null,c),c=$CLJS.Wa(c)):c=d;return c},b));return $CLJS.n(b)?$CLJS.Wa($CLJS.B(b))?$CLJS.z(b):Cpa(a,b):null};
Fpa=function(a,b){var c=$CLJS.HD(a);c=$CLJS.O(c);var d=$CLJS.J.g(c,$CLJS.rO);return $CLJS.n(d)?(b=$CLJS.Ie($CLJS.nf(function(e){return $CLJS.E.g($CLJS.uz($CLJS.$Y,$CLJS.YY)(e),d)},b)),$CLJS.n(b)?$CLJS.Wa($CLJS.B(b))?$CLJS.z(b):console.warn("Multiple plausible matches with the same :join-alias - more disambiguation needed",new $CLJS.h(null,2,[$CLJS.W,a,Epa,b],null)):null):Dpa(a,b)};Gpa=new $CLJS.M("metabase.lib.equality","no-right","metabase.lib.equality/no-right",2015744769);
Hpa=new $CLJS.M("metabase.lib.equality","no-left","metabase.lib.equality/no-left",-1403666439);$CLJS.u1=new $CLJS.M(null,"generous?","generous?",1247836118);$CLJS.Ipa=new $CLJS.M(null,"matching-refs","matching-refs",324693611);Epa=new $CLJS.M(null,"matches","matches",635497998);v1=new $CLJS.M(null,"left","left",-399115937);w1=new $CLJS.M("metabase.lib.equality","different-dispatch-values","metabase.lib.equality/different-dispatch-values",-2107733395);$CLJS.t1=function(){var a=$CLJS.Ze($CLJS.N),b=$CLJS.Ze($CLJS.N),c=$CLJS.Ze($CLJS.N),d=$CLJS.Ze($CLJS.N),e=$CLJS.J.j(new $CLJS.h(null,1,[$CLJS.Jk,$CLJS.bB],null),$CLJS.Jk,$CLJS.Xh.o?$CLJS.Xh.o():$CLJS.Xh.call(null));return new $CLJS.fi($CLJS.Hh.g("metabase.lib.equality","\x3d"),function(f,k){f=$CLJS.SA(f);k=$CLJS.SA(k);return $CLJS.gk.g(f,k)?w1:f},e,a,b,c,d)}();$CLJS.t1.m(null,w1,function(){return!1});
$CLJS.t1.m(null,$CLJS.jA,function(a,b){var c=p1(a),d=p1(b);return $CLJS.E.g(c,d)&&$CLJS.Te(function(e){return $CLJS.t1.g($CLJS.J.g(a,e),$CLJS.J.g(b,e))},c)});$CLJS.t1.m(null,$CLJS.hA,function(a,b){var c=$CLJS.E.g($CLJS.D(a),$CLJS.D(b));if(c)for(c=$CLJS.y(a),$CLJS.z(c),$CLJS.B(c),c=$CLJS.y(b),$CLJS.z(c),$CLJS.B(c),c=a,a=b;;){c=$CLJS.y(c);b=$CLJS.z(c);var d=$CLJS.B(c);c=b;b=d;a=$CLJS.y(a);d=$CLJS.z(a);a=$CLJS.B(a);c=$CLJS.t1.g(c,d);if($CLJS.n(c)){if(c=$CLJS.ud(b))return c;c=b}else return c}else return c});
var h1=null;$CLJS.t1.m(null,$CLJS.TU,function(a,b){var c=h1;h1=new $CLJS.h(null,2,[v1,q1(a),$CLJS.pw,q1(b)],null);try{var d=$CLJS.kH($CLJS.t1,$CLJS.jA);return d.g?d.g(a,b):d.call(null,a,b)}finally{h1=c}});
$CLJS.t1.m(null,$CLJS.aF,function(a,b){var c=$CLJS.I(a,0,null),d=$CLJS.I(a,1,null),e=$CLJS.I(a,2,null),f=$CLJS.I(b,0,null),k=$CLJS.I(b,1,null),l=$CLJS.I(b,2,null);return(a=$CLJS.E.l(3,$CLJS.D(a),$CLJS.H([$CLJS.D(b)])))?(c=$CLJS.E.g(c,f))?(d=$CLJS.t1.g(d,k),$CLJS.n(d)?$CLJS.n(h1)?$CLJS.E.g(i1(new $CLJS.Q(null,2,5,$CLJS.R,[v1,e],null),Hpa),i1(new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.pw,l],null),Gpa)):$CLJS.E.g(e,l):d):c:a});
$CLJS.t1.m(null,$CLJS.ei,function(a,b){if($CLJS.yd(a)){var c=$CLJS.kH($CLJS.t1,$CLJS.jA);return c.g?c.g(a,b):c.call(null,a,b)}return $CLJS.xd(a)?(c=$CLJS.kH($CLJS.t1,$CLJS.hA),c.g?c.g(a,b):c.call(null,a,b)):$CLJS.E.g(a,b)});
$CLJS.x1=function(){function a(f,k,l,m,t){var u=$CLJS.vV(l)?l:$CLJS.oV(l);$CLJS.I(u,0,null);$CLJS.I(u,1,null);var v=$CLJS.I(u,2,null),x=e.j?e.j(u,m,t):e.call(null,u,m,t);return $CLJS.n(x)?x:$CLJS.n($CLJS.n(f)?"number"===typeof v:f)&&(m=$CLJS.Ie($CLJS.ik.g($CLJS.Si,m)),$CLJS.n(m)&&(k=$CLJS.vV(l)?$CLJS.r1(f,k,v):l,$CLJS.n(k)))?(f=$CLJS.T.j,l=$CLJS.KY.h(k),k=$CLJS.n(l)?l:$CLJS.U.h(k),u=$CLJS.JD(f.call($CLJS.T,u,2,k),$CLJS.Xe($CLJS.zk,new $CLJS.h(null,1,[$CLJS.nA,$CLJS.lj],null))),e.j?e.j(u,m,t):e.call(null,
u,m,t)):null}function b(f,k,l,m){return e.M?e.M(f,k,l,m,$CLJS.N):e.call(null,f,k,l,m,$CLJS.N)}function c(f,k,l){var m=$CLJS.I(f,0,null);$CLJS.I(f,1,null);var t=$CLJS.I(f,2,null);l=$CLJS.O(l);l=$CLJS.J.g(l,$CLJS.u1);switch(m instanceof $CLJS.M?m.S:null){case "aggregation":return $CLJS.rG(function(u){return $CLJS.E.g($CLJS.IJ.h(u),$CLJS.hK)&&$CLJS.E.g($CLJS.t0.h(u),t)},k);case "expression":case "field":switch(k="string"===typeof t?zpa(f,k):Apa(f,k,l),$CLJS.D(k)){case 0:return null;case 1:return $CLJS.z(k);
default:return Fpa(f,k)}default:throw $CLJS.ji("Unknown type of ref",new $CLJS.h(null,1,[$CLJS.W,f],null));}}function d(f,k){return e.j?e.j(f,k,$CLJS.N):e.call(null,f,k,$CLJS.N)}var e=null;e=function(f,k,l,m,t){switch(arguments.length){case 2:return d.call(this,f,k);case 3:return c.call(this,f,k,l);case 4:return b.call(this,f,k,l,m);case 5:return a.call(this,f,k,l,m,t)}throw Error("Invalid arity: "+arguments.length);};e.g=d;e.j=c;e.v=b;e.M=a;return e}();
$CLJS.Jpa=function(){function a(d,e,f,k){return $CLJS.x1.v(d,e,$CLJS.sY.j(d,e,f),k)}function b(d,e,f){return c.v?c.v(d,-1,e,f):c.call(null,d,-1,e,f)}var c=null;c=function(d,e,f,k){switch(arguments.length){case 3:return b.call(this,d,e,f);case 4:return a.call(this,d,e,f,k)}throw Error("Invalid arity: "+arguments.length);};c.j=b;c.v=a;return c}();