var window=global;var $CLJS=require("./cljs_env.js");require("./cljs.core.js");require("./malli.core.js");require("./medley.core.js");require("./metabase.lib.hierarchy.js");require("./metabase.lib.schema.common.js");require("./metabase.lib.schema.expression.js");require("./metabase.lib.schema.mbql_clause.js");require("./metabase.lib.schema.temporal_bucketing.js");require("./metabase.types.js");require("./metabase.util.malli.registry.js");
'use strict';var sG,tG,vG,wG,eha,fha,gha,xG,uG;$CLJS.qG=function(a,b){return $CLJS.hc($CLJS.fb(function(c,d){var e=a.h?a.h(d):a.call(null,d);return $CLJS.jg.j(c,e,$CLJS.de.g($CLJS.J.j(c,e,$CLJS.Ef),d))},$CLJS.ec($CLJS.N),b))};$CLJS.rG=function(a,b){return $CLJS.fb(function(c,d){return $CLJS.n(a.h?a.h(d):a.call(null,d))?$CLJS.Tc(d):null},null,b)};
sG=function(a,b){$CLJS.I(a,0,null);$CLJS.I(a,1,null);$CLJS.I(a,2,null);a=$CLJS.I(a,3,null);b=$CLJS.nB(b,$CLJS.OB)?$CLJS.bG:$CLJS.nB(b,$CLJS.OC)?$CLJS.dD:$CLJS.nB(b,$CLJS.oC)?$CLJS.eD:null;return $CLJS.n(b)?$CLJS.qE(b,a):!0};
tG=function(a){a=$CLJS.y(a);$CLJS.z(a);a=$CLJS.B(a);$CLJS.z(a);a=$CLJS.B(a);a=$CLJS.qG(function(d){return $CLJS.nB($CLJS.OD(d),$CLJS.$B)},a);var b=$CLJS.O(a);a=$CLJS.J.g(b,!1);b=$CLJS.J.g(b,!0);if($CLJS.gk.g($CLJS.D(a),1))return"Temporal arithmetic expression must contain exactly one non-interval value";if(1>$CLJS.D(b))return"Temporal arithmetic expression must contain at least one :interval";var c=$CLJS.OD($CLJS.z(a));return $CLJS.Ue(function(d){$CLJS.I(d,0,null);$CLJS.I(d,1,null);$CLJS.I(d,2,null);
var e=$CLJS.I(d,3,null);return $CLJS.n(sG(d,c))?null:["Cannot add a ",$CLJS.p.h(e)," interval to a ",$CLJS.p.h(c)," expression"].join("")},b)};
vG=function(a){return new $CLJS.Q(null,4,5,$CLJS.R,[$CLJS.mr,new $CLJS.h(null,1,[$CLJS.ss,[$CLJS.p.h(a)," clause with a temporal expression and one or more :interval clauses"].join("")],null),new $CLJS.Q(null,6,5,$CLJS.R,[$CLJS.Uq,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Nj,a],null),new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Uk,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.yD],null)],null),new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Sq,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Uk,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,uG],null)],
null)],null),new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Uk,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.WD],null)],null),new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Sq,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Uk,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,uG],null)],null)],null)],null),new $CLJS.Q(null,3,5,$CLJS.R,[$CLJS.Mi,new $CLJS.h(null,1,[$CLJS.Ds,function(b){b=$CLJS.O(b);b=$CLJS.J.g(b,$CLJS.nj);return["Invalid ",$CLJS.p.h(a)," clause: ",$CLJS.p.h(tG(b))].join("")}],null),$CLJS.Ve(tG)],null)],null)};
wG=function(a){return new $CLJS.Q(null,5,5,$CLJS.R,[$CLJS.Uq,new $CLJS.h(null,1,[$CLJS.ss,[$CLJS.p.h(a)," clause with numeric args"].join("")],null),new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Nj,a],null),new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Uk,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.yD],null)],null),new $CLJS.Q(null,3,5,$CLJS.R,[$CLJS.Sq,new $CLJS.h(null,1,[$CLJS.ln,2],null),new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Uk,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.jE],null)],null)],null)],null)};
eha=function(a){return $CLJS.Rd($CLJS.tE,$CLJS.kf.g(function(b){var c=$CLJS.OD(b),d=$CLJS.nB(c,$CLJS.$D);b=d?$CLJS.qE($CLJS.pF,b):d;return $CLJS.n(b)?$CLJS.uj:c},a))};fha=function(a){a=$CLJS.rG(function(b){return!$CLJS.nB(b,$CLJS.$B)},$CLJS.kf.g($CLJS.OD,a));return $CLJS.nB(a,$CLJS.$D)?$CLJS.zj:a};
gha=function(a,b){return $CLJS.n($CLJS.Ue(function(c){return $CLJS.nB($CLJS.OD(c),$CLJS.$B)},b))?fha(b):$CLJS.E.g(a,$CLJS.Yr)&&$CLJS.E.g($CLJS.D(b),2)&&($CLJS.Te(function(c){return $CLJS.nB($CLJS.OD(c),$CLJS.OB)},b)||$CLJS.Te(function(c){return $CLJS.nB($CLJS.OD(c),$CLJS.oC)},b))?$CLJS.$B:eha(b)};xG=new $CLJS.M("metabase.lib.schema.expression.arithmetic","args.numbers","metabase.lib.schema.expression.arithmetic/args.numbers",-179216621);
$CLJS.yG=new $CLJS.M("lib.type-of","type-is-type-of-arithmetic-args","lib.type-of/type-is-type-of-arithmetic-args",-626871615);uG=new $CLJS.M("mbql.clause","interval","mbql.clause/interval",-990446354);$CLJS.Y(new $CLJS.M("metabase.lib.schema.expression.arithmetic","args.temporal","metabase.lib.schema.expression.arithmetic/args.temporal",1338604923),new $CLJS.Q(null,3,5,$CLJS.R,[$CLJS.mr,new $CLJS.Q(null,3,5,$CLJS.R,[$CLJS.Xq,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.UD,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Uk,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.WD],null)],null)],null),new $CLJS.Q(null,2,5,$CLJS.R,[new $CLJS.M(null,"intervals","intervals",2096054013),new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Kq,new $CLJS.Q(null,
2,5,$CLJS.R,[$CLJS.W,uG],null)],null)],null)],null),new $CLJS.Q(null,3,5,$CLJS.R,[$CLJS.Mi,new $CLJS.h(null,1,[$CLJS.ss,"Temporal arithmetic expression with valid interval units for the expression type"],null),function(a){var b=$CLJS.y(a);a=$CLJS.z(b);b=$CLJS.B(b);var c=$CLJS.OD(a);return $CLJS.Te(function(d){return sG(d,c)},b)}],null)],null));
$CLJS.Y(xG,new $CLJS.Q(null,3,5,$CLJS.R,[$CLJS.Sq,new $CLJS.h(null,1,[$CLJS.ln,2],null),new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Uk,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.jE],null)],null)],null));
var hha=new $CLJS.Q(null,6,5,$CLJS.R,[$CLJS.Uq,new $CLJS.h(null,1,[$CLJS.ss,":- clause taking the difference of two temporal expressions"],null),new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Nj,$CLJS.Yr],null),new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Uk,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.yD],null)],null),new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Uk,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.WD],null)],null),new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Uk,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.WD],null)],null)],
null);$CLJS.KF.g($CLJS.Kq,new $CLJS.Q(null,3,5,$CLJS.R,[$CLJS.fr,vG($CLJS.Kq),wG($CLJS.Kq)],null));$CLJS.KF.g($CLJS.Yr,new $CLJS.Q(null,4,5,$CLJS.R,[$CLJS.fr,vG($CLJS.Yr),hha,wG($CLJS.Yr)],null));$CLJS.AE($CLJS.Lq,$CLJS.H([new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Kr,xG],null)]));$CLJS.AE($CLJS.FF,$CLJS.H([$CLJS.Yr,$CLJS.LC,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Kr,xG],null)]));
for(var zG=$CLJS.y(new $CLJS.Q(null,3,5,$CLJS.R,[$CLJS.Kq,$CLJS.Yr,$CLJS.Lq],null)),AG=null,BG=0,CG=0;;)if(CG<BG){var iha=AG.X(null,CG);$CLJS.rE(iha,$CLJS.yG);CG+=1}else{var DG=$CLJS.y(zG);if(DG){var EG=DG;if($CLJS.Bd(EG)){var FG=$CLJS.mc(EG),jha=$CLJS.nc(EG),kha=FG,lha=$CLJS.D(FG);zG=jha;AG=kha;BG=lha}else{var mha=$CLJS.z(EG);$CLJS.rE(mha,$CLJS.yG);zG=$CLJS.B(EG);AG=null;BG=0}CG=0}else break}
$CLJS.ND.m(null,$CLJS.yG,function(a){var b=$CLJS.y(a);a=$CLJS.z(b);b=$CLJS.B(b);$CLJS.z(b);b=$CLJS.B(b);return gha(a,b)});$CLJS.yE($CLJS.LE,$CLJS.H([new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Uk,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.jE],null)],null)]));$CLJS.rE($CLJS.LE,$CLJS.dE);
for(var GG=$CLJS.y(new $CLJS.Q(null,3,5,$CLJS.R,[$CLJS.HF,$CLJS.CE,$CLJS.ZE],null)),HG=null,IG=0,JG=0;;)if(JG<IG){var nha=HG.X(null,JG);$CLJS.yE(nha,$CLJS.H([$CLJS.Yr,$CLJS.LC,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Uk,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.jE],null)],null)]));JG+=1}else{var KG=$CLJS.y(GG);if(KG){var LG=KG;if($CLJS.Bd(LG)){var MG=$CLJS.mc(LG),oha=$CLJS.nc(LG),pha=MG,qha=$CLJS.D(MG);GG=oha;HG=pha;IG=qha}else{var rha=$CLJS.z(LG);$CLJS.yE(rha,$CLJS.H([$CLJS.Yr,$CLJS.LC,new $CLJS.Q(null,
2,5,$CLJS.R,[$CLJS.Uk,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.jE],null)],null)]));GG=$CLJS.B(LG);HG=null;IG=0}JG=0}else break}
for(var NG=$CLJS.y(new $CLJS.Q(null,3,5,$CLJS.R,[$CLJS.GE,$CLJS.jF,$CLJS.qF],null)),OG=null,PG=0,QG=0;;)if(QG<PG){var sha=OG.X(null,QG);$CLJS.yE(sha,$CLJS.H([$CLJS.Yr,$CLJS.hj,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Uk,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.jE],null)],null)]));QG+=1}else{var RG=$CLJS.y(NG);if(RG){var SG=RG;if($CLJS.Bd(SG)){var TG=$CLJS.mc(SG),tha=$CLJS.nc(SG),uha=TG,vha=$CLJS.D(TG);NG=tha;OG=uha;PG=vha}else{var wha=$CLJS.z(SG);$CLJS.yE(wha,$CLJS.H([$CLJS.Yr,$CLJS.hj,new $CLJS.Q(null,
2,5,$CLJS.R,[$CLJS.Uk,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.jE],null)],null)]));NG=$CLJS.B(SG);OG=null;PG=0}QG=0}else break}$CLJS.yE($CLJS.IE,$CLJS.H([new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Uk,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.jE],null)],null),new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Uk,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.jE],null)],null)]));
$CLJS.ND.m(null,$CLJS.IE,function(a){$CLJS.I(a,0,null);$CLJS.I(a,1,null);var b=$CLJS.I(a,2,null);a=$CLJS.I(a,3,null);return $CLJS.nB($CLJS.OD(b),$CLJS.hj)&&$CLJS.nB($CLJS.OD(a),$CLJS.hj)?$CLJS.hj:$CLJS.LC});