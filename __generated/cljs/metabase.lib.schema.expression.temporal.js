var window=global;var $CLJS=require("./cljs_env.js");require("./cljs.core.js");require("./clojure.set.js");require("./malli.core.js");require("./metabase.lib.hierarchy.js");require("./metabase.lib.schema.common.js");require("./metabase.lib.schema.expression.js");require("./metabase.lib.schema.literal.js");require("./metabase.lib.schema.mbql_clause.js");require("./metabase.lib.schema.temporal_bucketing.js");require("./metabase.shared.util.internal.time_common.js");require("./metabase.util.malli.registry.js");require("./shadow.js.shim.module$moment.js");require("./shadow.js.shim.module$moment_timezone.js");
'use strict';var OH,QH,SH,aI,dI,iI;$CLJS.NH=new $CLJS.M(null,"get-month","get-month",-369374731);OH=new $CLJS.M("metabase.lib.schema.expression.temporal","absolute-datetime.options","metabase.lib.schema.expression.temporal/absolute-datetime.options",-925669633);$CLJS.PH=new $CLJS.M(null,"convert-timezone","convert-timezone",-124803001);QH=new $CLJS.M("metabase.lib.schema.expression.temporal","temporal-extract.unit","metabase.lib.schema.expression.temporal/temporal-extract.unit",339336486);
$CLJS.RH=new $CLJS.M(null,"iso","iso",-1366207543);SH=new $CLJS.M("metabase.lib.schema.expression.temporal","absolute-datetime.base-type","metabase.lib.schema.expression.temporal/absolute-datetime.base-type",-904703365);$CLJS.TH=new $CLJS.M(null,"get-second","get-second",-2065946318);$CLJS.UH=new $CLJS.M(null,"get-year","get-year",-936011274);$CLJS.VH=new $CLJS.M(null,"absolute-datetime","absolute-datetime",-560340465);
$CLJS.WH=new $CLJS.M("lib.type-of","type-is-temporal-type-of-first-arg","lib.type-of/type-is-temporal-type-of-first-arg",76272405);$CLJS.XH=new $CLJS.M(null,"week-of-year-iso","week-of-year-iso",-1827744293);$CLJS.YH=new $CLJS.M(null,"us","us",746429226);$CLJS.ZH=new $CLJS.M(null,"datetime","datetime",494675702);$CLJS.$H=new $CLJS.M(null,"now","now",-1650525531);
aI=new $CLJS.M("metabase.lib.schema.expression.temporal","temporal-extract.week-mode","metabase.lib.schema.expression.temporal/temporal-extract.week-mode",430590916);$CLJS.bI=new $CLJS.M(null,"instance","instance",-2121349050);$CLJS.cI=new $CLJS.M(null,"get-day","get-day",127568857);dI=new $CLJS.M("metabase.lib.schema.expression.temporal","relative-datetime.amount","metabase.lib.schema.expression.temporal/relative-datetime.amount",7216442);$CLJS.eI=new $CLJS.M(null,"get-minute","get-minute",1468086343);
$CLJS.fI=new $CLJS.M(null,"get-day-of-week","get-day-of-week",2010140752);$CLJS.gI=new $CLJS.M("metabase.lib.schema.expression.temporal","timezone-id","metabase.lib.schema.expression.temporal/timezone-id",-1909635091);$CLJS.hI=new $CLJS.M(null,"get-hour","get-hour",622714059);iI=new $CLJS.M("metabase.lib.schema.expression.temporal","get-week-mode","metabase.lib.schema.expression.temporal/get-week-mode",1489967652);$CLJS.jI=new $CLJS.M(null,"get-quarter","get-quarter",1327778593);
$CLJS.kI=new $CLJS.M(null,"week-of-year-us","week-of-year-us",849423511);$CLJS.lI=new $CLJS.M(null,"week-of-year-instance","week-of-year-instance",2047974624);$CLJS.mI=new $CLJS.M(null,"target","target",253001721);$CLJS.yE($CLJS.UA,$CLJS.H([$CLJS.Yr,$CLJS.$B,$CLJS.rr,$CLJS.eD]));$CLJS.ND.m(null,$CLJS.WH,function(a){$CLJS.I(a,0,null);$CLJS.I(a,1,null);a=$CLJS.I(a,2,null);a=$CLJS.OD(a);return $CLJS.wd(a)?(a=$CLJS.bt.g(a,new $CLJS.ch(null,new $CLJS.h(null,2,[$CLJS.OB,null,$CLJS.oC,null],null),null)),$CLJS.E.g($CLJS.D(a),1)?$CLJS.z(a):a):a});$CLJS.rE($CLJS.WH,$CLJS.dE);
for(var nI=$CLJS.y(new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.XA,$CLJS.$A],null)),oI=null,pI=0,qI=0;;)if(qI<pI){var rI=oI.X(null,qI);$CLJS.yE(rI,$CLJS.H([new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.WD],null),$CLJS.rr,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.eD],null)]));$CLJS.rE(rI,$CLJS.WH);qI+=1}else{var sI=$CLJS.y(nI);if(sI){var tI=sI;if($CLJS.Bd(tI)){var uI=$CLJS.mc(tI),fia=$CLJS.nc(tI),gia=uI,hia=$CLJS.D(uI);nI=fia;oI=gia;pI=hia}else{var vI=$CLJS.z(tI);$CLJS.yE(vI,$CLJS.H([new $CLJS.Q(null,2,5,$CLJS.R,
[$CLJS.W,$CLJS.WD],null),$CLJS.rr,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.eD],null)]));$CLJS.rE(vI,$CLJS.WH);nI=$CLJS.B(tI);oI=null;pI=0}qI=0}else break}
for(var wI=$CLJS.y(new $CLJS.Q(null,7,5,$CLJS.R,[$CLJS.UH,$CLJS.NH,$CLJS.cI,$CLJS.hI,$CLJS.eI,$CLJS.TH,$CLJS.jI],null)),xI=null,yI=0,zI=0;;)if(zI<yI){var iia=xI.X(null,zI);$CLJS.yE(iia,$CLJS.H([$CLJS.Yr,$CLJS.hj,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Uk,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.WD],null)],null)]));zI+=1}else{var AI=$CLJS.y(wI);if(AI){var BI=AI;if($CLJS.Bd(BI)){var CI=$CLJS.mc(BI),jia=$CLJS.nc(BI),kia=CI,lia=$CLJS.D(CI);wI=jia;xI=kia;yI=lia}else{var mia=$CLJS.z(BI);$CLJS.yE(mia,$CLJS.H([$CLJS.Yr,
$CLJS.hj,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Uk,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.WD],null)],null)]));wI=$CLJS.B(BI);xI=null;yI=0}zI=0}else break}$CLJS.yE($CLJS.TA,$CLJS.H([$CLJS.Yr,$CLJS.hj,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Uk,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.WD],null)],null),new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Uk,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.WD],null)],null),new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.ZF],null)]));
for(var DI=$CLJS.y(new $CLJS.ch(null,new $CLJS.h(null,8,[$CLJS.jI,null,$CLJS.eI,null,$CLJS.hI,null,$CLJS.fI,null,$CLJS.TH,null,$CLJS.NH,null,$CLJS.UH,null,$CLJS.cI,null],null),null)),EI=null,FI=0,GI=0;;)if(GI<FI){var nia=EI.X(null,GI);$CLJS.yE(nia,$CLJS.H([$CLJS.Yr,$CLJS.hj,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Uk,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.WD],null)],null)]));GI+=1}else{var HI=$CLJS.y(DI);if(HI){var II=HI;if($CLJS.Bd(II)){var JI=$CLJS.mc(II),oia=$CLJS.nc(II),pia=JI,qia=$CLJS.D(JI);
DI=oia;EI=pia;FI=qia}else{var ria=$CLJS.z(II);$CLJS.yE(ria,$CLJS.H([$CLJS.Yr,$CLJS.hj,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Uk,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.WD],null)],null)]));DI=$CLJS.B(II);EI=null;FI=0}GI=0}else break}$CLJS.Y(iI,new $CLJS.Q(null,4,5,$CLJS.R,[$CLJS.cr,$CLJS.RH,$CLJS.YH,$CLJS.bI],null));
$CLJS.AE($CLJS.WA,$CLJS.H([$CLJS.Yr,$CLJS.hj,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.ZH,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Uk,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.WD],null)],null)],null),new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.xi,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Mq,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Uk,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,iI],null)],null)],null)],null)]));
$CLJS.Y($CLJS.gI,new $CLJS.Q(null,3,5,$CLJS.R,[$CLJS.mr,$CLJS.sD,new $CLJS.Q(null,3,5,$CLJS.R,[$CLJS.fr,$CLJS.gg.g(new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.cr,new $CLJS.h(null,2,[$CLJS.ss,"valid timezone ID",$CLJS.Ds,function(a){a=$CLJS.O(a);a=$CLJS.J.g(a,$CLJS.nj);return["invalid timezone ID: ",$CLJS.Oh.l($CLJS.H([a]))].join("")}],null)],null),$CLJS.xz($CLJS.Kd,$CLJS.MH.tz.names())),$CLJS.DH],null)],null));
$CLJS.AE($CLJS.PH,$CLJS.H([new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.ZH,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Uk,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.WD],null)],null)],null),new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.mI,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Uk,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.gI],null)],null)],null),new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Vy,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Mq,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Uk,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.gI],null)],null)],null)],
null)]));$CLJS.rE($CLJS.PH,$CLJS.WH);$CLJS.yE($CLJS.$H,$CLJS.H([$CLJS.Yr,$CLJS.SB]));$CLJS.Y(SH,new $CLJS.Q(null,3,5,$CLJS.R,[$CLJS.mr,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.CD],null),new $CLJS.Q(null,3,5,$CLJS.R,[$CLJS.Mi,new $CLJS.h(null,1,[$CLJS.ss,":absolute-datetime base-type must derive from :type/Date or :type/DateTime"],null),function(a){return $CLJS.Ue(function(b){return $CLJS.nB(a,b)},new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.OB,$CLJS.oC],null))}],null)],null));
$CLJS.Y(OH,new $CLJS.Q(null,3,5,$CLJS.R,[$CLJS.rs,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.yD],null),new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Gj,new $CLJS.Q(null,3,5,$CLJS.R,[$CLJS.nA,new $CLJS.h(null,1,[$CLJS.Ar,!0],null),new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,SH],null)],null)],null)],null));
$CLJS.KF.g($CLJS.VH,new $CLJS.Q(null,5,5,$CLJS.R,[$CLJS.Uq,new $CLJS.h(null,1,[$CLJS.ss,"valid :absolute-datetime clause"],null),new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Nj,$CLJS.VH],null),new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Uk,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,OH],null)],null),new $CLJS.Q(null,3,5,$CLJS.R,[$CLJS.Wq,new $CLJS.Q(null,4,5,$CLJS.R,[$CLJS.Uq,new $CLJS.h(null,1,[$CLJS.ss,":absolute-datetime literal and unit for :type/Date"],null),new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Uk,new $CLJS.Q(null,
4,5,$CLJS.R,[$CLJS.fr,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.HH],null),new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.JH],null),new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.BH],null)],null)],null),new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Uk,new $CLJS.Q(null,3,5,$CLJS.R,[$CLJS.fr,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Nj,$CLJS.ei],null),new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.$F],null)],null)],null)],null),new $CLJS.Q(null,4,5,$CLJS.R,[$CLJS.Uq,new $CLJS.h(null,1,[$CLJS.ss,":absolute-datetime literal and unit for :type/DateTime"],
null),new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Uk,new $CLJS.Q(null,3,5,$CLJS.R,[$CLJS.fr,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Nj,$CLJS.Ou],null),new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.LH],null)],null)],null),new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Uk,new $CLJS.Q(null,3,5,$CLJS.R,[$CLJS.fr,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Nj,$CLJS.ei],null),new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.WF],null)],null)],null)],null)],null)],null));
$CLJS.ND.m(null,$CLJS.VH,function(a){$CLJS.I(a,0,null);$CLJS.I(a,1,null);var b=$CLJS.I(a,2,null);a=$CLJS.I(a,3,null);a=$CLJS.E.g(b,$CLJS.Ou)?$CLJS.E.g(a,$CLJS.ei)?$CLJS.oC:$CLJS.n($CLJS.qE($CLJS.$F,a))?$CLJS.OB:$CLJS.oC:null;if($CLJS.n(a))return a;a="string"===typeof b?$CLJS.n($CLJS.ph($CLJS.yH,b))?$CLJS.OB:$CLJS.n($CLJS.ph($CLJS.zH,b))?$CLJS.OB:null:null;if($CLJS.n(a))return a;b=$CLJS.OD(b);b=$CLJS.wd(b)?$CLJS.gg.j($CLJS.dh,$CLJS.mf(function(c){return $CLJS.nB(c,$CLJS.zj)}),b):b;return $CLJS.wd(b)&&
$CLJS.E.g($CLJS.D(b),1)?$CLJS.z(b):b});$CLJS.Y(dI,new $CLJS.Q(null,3,5,$CLJS.R,[$CLJS.fr,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Nj,$CLJS.Ou],null),$CLJS.rr],null));
$CLJS.AE($CLJS.VA,$CLJS.H([$CLJS.Yr,$CLJS.oC,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Mj,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Uk,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,dI],null)],null)],null),new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Ek,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Mq,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Uk,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.eD],null)],null)],null)],null)]));
$CLJS.yE($CLJS.Ax,$CLJS.H([$CLJS.Yr,$CLJS.OC,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Uk,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.hE],null)],null),new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.dD],null)]));$CLJS.Y(QH,new $CLJS.Q(null,12,5,$CLJS.R,[$CLJS.cr,$CLJS.YF,$CLJS.Gk,$CLJS.Ok,$CLJS.XH,$CLJS.kI,$CLJS.lI,$CLJS.Lk,$CLJS.Hk,$CLJS.Fk,$CLJS.Kk,$CLJS.VF],null));$CLJS.Y(aI,new $CLJS.Q(null,4,5,$CLJS.R,[$CLJS.cr,$CLJS.RH,$CLJS.YH,$CLJS.bI],null));
$CLJS.AE($CLJS.YA,$CLJS.H([$CLJS.Yr,$CLJS.hj,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.ZH,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Uk,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,$CLJS.WD],null)],null)],null),new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Ek,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Uk,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,QH],null)],null)],null),new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.xi,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Mq,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.Uk,new $CLJS.Q(null,2,5,$CLJS.R,[$CLJS.W,aI],null)],null)],
null)],null)]));